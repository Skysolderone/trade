#!/bin/bash

set -e

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘          å¼€å§‹æ„å»º Trade é¡¹ç›®                                   â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# æ£€æŸ¥Goç¯å¢ƒ
if ! command -v go &> /dev/null; then
    echo "âŒ é”™è¯¯: æœªå®‰è£… Go ç¯å¢ƒ"
    exit 1
fi

echo "Go ç‰ˆæœ¬: $(go version)"
echo ""

# åˆ›å»ºè¾“å‡ºç›®å½•
mkdir -p bin

# æ„å»ºä¸»ç¨‹åºï¼ˆç­–ç•¥åˆ†æå’Œå®šæ—¶ä»»åŠ¡ï¼‰
echo "ğŸ“¦ æ„å»ºä¸»ç¨‹åº: trade"
CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o bin/trade -ldflags="-s -w" main.go
echo "âœ… ä¸»ç¨‹åºæ„å»ºå®Œæˆ: bin/trade"
echo ""

# æ„å»ºWebæœåŠ¡å™¨
echo "ğŸ“¦ æ„å»ºWebæœåŠ¡å™¨: web_server"
CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o bin/web_server -ldflags="-s -w" ./cmd/web/main.go
echo "âœ… WebæœåŠ¡å™¨æ„å»ºå®Œæˆ: bin/web_server"
echo ""

# æ„å»ºå°æ—¶å†å²æ•°æ®è·å–å·¥å…·
echo "ğŸ“¦ æ„å»ºå·¥å…·: get_hourly_history"
CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o bin/get_hourly_history -ldflags="-s -w" ./cmd/get_hourly_history/main.go
echo "âœ… å·¥å…·æ„å»ºå®Œæˆ: bin/get_hourly_history"
echo ""

# æ˜¾ç¤ºæ–‡ä»¶å¤§å°
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "æ„å»ºç»“æœ:"
ls -lh bin/
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘          æ„å»ºå®Œæˆï¼                                            â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ’¡ æç¤º:"
echo "  - ä¸»ç¨‹åº: ./bin/trade -mode=daemon"
echo "  - WebæœåŠ¡: ./bin/web_server -port=8080"
echo "  - å†å²æ•°æ®å·¥å…·: ./bin/get_hourly_history"
